# 现有系统架构和功能分析

## 1. 系统架构

### 1.1 目录结构

```
backend/
├── main.py              # 主入口脚本
├── src/
│   ├── crawler/
│   │   └── auto_crawler.py  # 自动化爬虫实现
│   ├── downloader/
│   │   └── download_thumbs.py  # 封面下载模块
│   ├── utils/
│   │   └── config.py     # 配置管理
├── data/                # 数据存储目录
│   ├── pending.json      # 待审核视频
│   ├── approved.json     # 已通过视频
│   ├── rejected.json     # 已拒绝视频
│   ├── videos.json       # 时间线数据
│   ├── lvjiang-bv.txt    # 驴酱BV号文件
│   └── tiantong-bv.txt   # 甜筒BV号文件
└── docs/                # 文档目录
```

### 1.2 核心模块

| 模块 | 主要功能 | 文件位置 |
|------|----------|----------|
| 主入口 | 命令行参数处理，调用爬虫功能 | `main.py` |
| 配置管理 | 管理系统配置参数 | `src/utils/config.py` |
| 爬虫模块 | 视频元数据爬取，数据存储 | `src/crawler/auto_crawler.py` |
| 封面下载 | 下载视频封面图片 | `src/downloader/download_thumbs.py` |

### 1.3 数据流

1. **输入**：
   - BV号文件（`lvjiang-bv.txt`, `tiantong-bv.txt`）
   - 关键词列表

2. **处理**：
   - 爬虫爬取视频元数据
   - 数据存储到JSON文件
   - 封面下载

3. **输出**：
   - 时间线数据（`videos.json`）
   - 封面图片

## 2. 系统功能

### 2.1 爬虫功能

- **从文件爬取**：读取BV号文件，爬取对应视频元数据
- **关键词爬取**：根据关键词搜索视频并爬取元数据
- **视频元数据爬取**：爬取视频标题、描述、发布时间、播放量等信息
- **数据去重**：避免重复爬取相同视频

### 2.2 数据管理

- **数据分类**：待审核、已通过、已拒绝
- **时间线生成**：生成排序后的时间线数据
- **封面管理**：下载和管理视频封面

### 2.3 命令行界面

- **模式选择**：文件模式或关键词模式
- **参数配置**：BV号文件路径、关键词、最大页码等
- **执行控制**：控制是否下载封面

## 3. 数据存储

### 3.1 存储结构

- **pending.json**：存储待审核的视频数据
- **approved.json**：存储已通过审核的视频数据
- **rejected.json**：存储已拒绝的视频数据
- **videos.json**：存储生成的时间线数据

### 3.2 数据格式

视频数据格式：

```json
{
  "bv": "视频BV号",
  "url": "视频URL",
  "title": "视频标题",
  "description": "视频描述",
  "publish_date": "发布日期",
  "views": 播放量,
  "danmaku": 弹幕数,
  "up主": "UP主名称",
  "cover_url": "封面图片URL",
  "thumbnail": "封面图片路径",
  "duration": "视频时长",
  "crawled_at": "爬取时间",
  "review_status": "审核状态",
  "review_note": "审核备注"
}
```

## 4. 现有问题

### 4.1 数据隔离问题

- **数据混存**：所有视频数据存储在同一套JSON文件中，没有甜筒/驴酱数据的分离
- **存储结构**：缺乏针对不同数据源的隔离机制
- **配置管理**：配置文件没有考虑多数据源的情况

### 4.2 用户界面问题

- **命令行界面**：只有命令行界面，使用不够直观
- **操作复杂度**：需要记忆命令参数，操作门槛较高
- **反馈机制**：缺乏图形化的操作反馈

### 4.3 扩展性问题

- **硬编码路径**：数据存储路径硬编码，不易扩展
- **单一配置**：配置文件缺乏灵活性，不支持多环境配置
- **模块化不足**：部分功能耦合度较高，不易维护

## 5. 技术栈

- **编程语言**：Python 3
- **核心库**：requests, BeautifulSoup4, json
- **数据存储**：JSON文件
- **界面**：命令行

## 6. 分析结论

现有系统是一个功能完整的B站视频爬虫系统，主要通过命令行界面操作，使用JSON文件存储数据。系统缺乏数据隔离机制和直观的用户界面，需要通过本次功能增强来解决这些问题。

### 6.1 改进机会

1. **数据隔离**：实现甜筒/驴酱数据的完全隔离
2. **GUI界面**：开发直观易用的图形化界面
3. **模块化设计**：提高系统的模块化程度和可维护性
4. **配置管理**：改进配置管理，支持多环境配置
5. **用户体验**：提高系统的用户友好性

## 7. 后续建议

1. **数据隔离方案**：采用目录隔离的方式，为甜筒和驴酱创建独立的数据目录
2. **GUI框架选择**：推荐使用PyQt5或Tkinter，提供跨平台支持
3. **配置管理改进**：使用YAML或JSON配置文件，支持多环境配置
4. **数据存储优化**：考虑使用SQLite或其他轻量级数据库，提高数据管理效率
5. **模块化重构**：对现有代码进行模块化重构，提高可维护性
