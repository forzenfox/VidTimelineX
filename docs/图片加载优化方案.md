# å›¾ç‰‡åŠ è½½ä¼˜åŒ–æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¶é—´**: 2026å¹´2æœˆ1æ—¥
- **æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
- **æœ€åæ›´æ–°**: 2026å¹´2æœˆ1æ—¥
- **ç›¸å…³æ–‡ä»¶**: `frontend/src/components/figma/ImageWithFallback.tsx`

---

## ä¸€ã€æ¦‚è¿°

### 1.1 èƒŒæ™¯

æœ¬é¡¹ç›®æ¶‰åŠä¸¤ç§å›¾ç‰‡åŠ è½½åœºæ™¯ï¼š
- **Bç«™CDNå›¾ç‰‡**: å°é¢å›¾URLæŒ‡å‘ `i0.hdslb.com` ç­‰Bç«™CDNæœåŠ¡å™¨
- **æœ¬åœ°ç¼“å­˜å›¾ç‰‡**: çˆ¬è™«ä¸‹è½½åˆ° `frontend/public/thumbs/` ç›®å½•çš„æœ¬åœ°å›¾ç‰‡

### 1.2 ä¼˜åŒ–ç›®æ ‡

1. **ä¼˜å…ˆä½¿ç”¨Bç«™CDNå›¾ç‰‡**: åˆ©ç”¨Bç«™CDNçš„å…¨çƒåŠ é€Ÿèƒ½åŠ›ï¼Œæå‡åŠ è½½é€Ÿåº¦
2. **å®¹é”™æœºåˆ¶**: CDNå›¾ç‰‡åŠ è½½å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°æœ¬åœ°å›¾ç‰‡
3. **è·¨åŸŸå¤„ç†**: è§£å†³Bç«™CDNå›¾ç‰‡çš„CORSé—®é¢˜ï¼Œæ”¯æŒcanvaså¯¼å‡ºç­‰æ“ä½œ
4. **æ‡’åŠ è½½ä¼˜åŒ–**: å‡å°‘é¦–å±åŠ è½½å‹åŠ›

---

## äºŒã€æ¶æ„è®¾è®¡

### 2.1 å›¾ç‰‡åŠ è½½æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è§†é¢‘æ•°æ®è·å–                                â”‚
â”‚  {                                                               â”‚
â”‚    cover_url: "https://i0.hdslb.com/bfs/archive/xxx.jpg", // CDN â”‚
â”‚    cover: "BV123456789.jpg"  // æœ¬åœ°æ–‡ä»¶å                        â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ImageWithFallback ç»„ä»¶                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. ä¼˜å…ˆå°è¯• cover_url (Bç«™CDN)                          â”‚   â”‚
â”‚  â”‚    - è‡ªåŠ¨æ·»åŠ  crossOrigin="anonymous"                   â”‚   â”‚
â”‚  â”‚    - ç›‘å¬ CORS é”™è¯¯                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚ åŠ è½½æˆåŠŸ                           â”‚
â”‚                             â–¼                                   â”‚
â”‚                    æ˜¾ç¤ºå°é¢å›¾ âœ…                                 â”‚
â”‚                             â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚ åŠ è½½å¤±è´¥ï¼ˆCORSï¼‰ â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                             â”‚ CORSé”™è¯¯                           â”‚
â”‚                             â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. å›é€€åˆ°æœ¬åœ° cover (priorityLoad=trueæ—¶)               â”‚   â”‚
â”‚  â”‚    - priorityLoad=true â†’ srcæ˜¯æœ¬åœ°ï¼Œå›é€€åˆ°src           â”‚   â”‚
â”‚  â”‚    - priorityLoad=false â†’ srcå·²æ˜¯æœ¬åœ°ï¼Œç›´æ¥ä½¿ç”¨          â”‚   â”‚
â”‚  â”‚    - æ ‡è®°ä¸º fallback çŠ¶æ€                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚ åŠ è½½æˆåŠŸ                           â”‚
â”‚                             â–¼                                   â”‚
â”‚                    æ˜¾ç¤ºæœ¬åœ°å›¾ç‰‡ ğŸŸ¢                               â”‚
â”‚                             â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚ åŠ è½½å¤±è´¥         â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                             â”‚ æ‰€æœ‰æºå¤±è´¥                         â”‚
â”‚                             â–¼                                   â”‚
â”‚                    æ˜¾ç¤ºé”™è¯¯å ä½ç¬¦ ğŸ”´                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç»„ä»¶ç»“æ„

```
src/components/figma/ImageWithFallback.tsx
â”‚
â”œâ”€â”€ ImageWithFallback (ä¸»ç»„ä»¶)
â”‚   â”œâ”€â”€ props:
â”‚   â”‚   â”œâ”€â”€ src: string              // ä¸»å›¾ç‰‡æºï¼ˆæœ¬åœ°è·¯å¾„ï¼‰
â”‚   â”‚   â”œâ”€â”€ fallbackSrc?: string     // å¤‡é€‰å›¾ç‰‡æºï¼ˆå¤–éƒ¨URLï¼‰
â”‚   â”‚   â”œâ”€â”€ priorityLoad?: boolean   // ä¼˜å…ˆåŠ è½½å¤–éƒ¨URL
â”‚   â”‚   â”œâ”€â”€ lazy?: boolean           // æ˜¯å¦æ‡’åŠ è½½
â”‚   â”‚   â””â”€â”€ crossOrigin?: string     // CORSæ¨¡å¼
â”‚   â”‚
â”‚   â””â”€â”€ åŠŸèƒ½:
â”‚       â”œâ”€â”€ è‡ªåŠ¨æ£€æµ‹å¤–éƒ¨URL
â”‚       â”œâ”€â”€ è‡ªåŠ¨æ·»åŠ  crossOrigin
â”‚       â”œâ”€â”€ CORSé”™è¯¯æ£€æµ‹ä¸å›é€€
â”‚       â””â”€â”€ åŠ è½½çŠ¶æ€è¿½è¸ª
â”‚
â”œâ”€â”€ VideoCover (è§†é¢‘å°é¢ä¸“ç”¨ç»„ä»¶)
â”‚   â””â”€â”€ å°è£…äº† cover_url + cover çš„ç»„åˆåŠ è½½é€»è¾‘
â”‚
â””â”€â”€ CanvasImage (Canvasä¸“ç”¨ç»„ä»¶)
    â”œâ”€â”€ è‡ªåŠ¨è®¾ç½® crossOrigin="anonymous"
    â”œâ”€â”€ æˆåŠŸ/å¤±è´¥å›è°ƒ
    â””â”€â”€ æ”¯æŒtoDataURLå¯¼å‡º
```

---

## ä¸‰ã€æ ¸å¿ƒå®ç°

### 3.1 ç±»å‹å®šä¹‰

```typescript
interface ImageWithFallbackProps extends React.ImgHTMLAttributes<HTMLImageElement> {
  src: string;                    // æœ¬åœ°å›¾ç‰‡è·¯å¾„
  alt: string;                    // å›¾ç‰‡æè¿°
  fallbackSrc?: string;           // å¤–éƒ¨URLï¼ˆå¤‡é€‰ï¼‰
  priorityLoad?: boolean;         // ä¼˜å…ˆåŠ è½½å¤–éƒ¨URL
  lazy?: boolean;                 // æ˜¯å¦æ‡’åŠ è½½
  crossOrigin?: "anonymous" | "use-credentials" | "";
}

interface VideoCoverProps {
  cover_url?: string;    // Bç«™CDNå°é¢å›¾URL
  cover: string;         // æœ¬åœ°å°é¢å›¾æ–‡ä»¶å
  alt: string;
  className?: string;
  priorityLoad?: boolean;  // é»˜è®¤trueï¼Œä¼˜å…ˆä½¿ç”¨cover_url
}

interface CanvasImageProps extends React.CanvasHTMLAttributes<HTMLCanvasElement> {
  cover_url?: string;
  cover: string;
  alt: string;
  onLoadSuccess?: (canvas: HTMLCanvasElement) => void;
  onLoadError?: (error: Error) => void;
}
```

### 3.2 æ ¸å¿ƒå‡½æ•°

```typescript
// æ£€æµ‹æ˜¯å¦ä¸ºå¤–éƒ¨URL
function isExternalUrl(url: string): boolean {
  return url.startsWith("http://") || url.startsWith("https://");
}

// æ£€æµ‹æ˜¯å¦ä¸ºBç«™CDN
function isBilibiliCdn(url: string): boolean {
  return url.includes("hdslb.com") || 
         url.includes("bilibili.com") || 
         url.includes("bilivideo.com");
}

// è·å–æœ¬åœ°å›¾ç‰‡å®Œæ•´è·¯å¾„
function getLocalImageUrl(filename: string): string {
  const baseUrl = getBaseUrl();
  if (isExternalUrl(filename)) return filename;
  if (filename.startsWith("/")) return filename;
  return `${baseUrl}thumbs/${filename}`;
}
```

### 3.3 åŠ è½½ç­–ç•¥

```typescript
// VideoCover ç»„ä»¶è°ƒç”¨æ–¹å¼
// <ImageWithFallback src={cover} fallbackSrc={cover_url} priorityLoad={true} />

// åŠ è½½ç­–ç•¥é€‰æ‹©ï¼ˆVideoCover é»˜è®¤ priorityLoad=trueï¼‰
if (priorityLoad && src) {
  if (isExternalUrl(src)) {
    // srcæ˜¯å¤–éƒ¨URLï¼Œç›´æ¥ä½¿ç”¨
    setCurrentSrc(src);
  } else if (fallbackSrc && isExternalUrl(fallbackSrc)) {
    // srcæ˜¯æœ¬åœ°ï¼Œfallbackæ˜¯å¤–éƒ¨CDN â†’ ä¼˜å…ˆä½¿ç”¨CDN
    setCurrentSrc(fallbackSrc);
    setFallbackUsed(true);
  } else {
    // ä½¿ç”¨æœ¬åœ°
    setCurrentSrc(getLocalImageUrl(src));
  }
}
```

### 3.4 CORSå¤„ç†

```typescript
// è‡ªåŠ¨ä¸ºå¤–éƒ¨å›¾ç‰‡æ·»åŠ CORS
const effectiveCrossOrigin = isExternalUrl(currentSrc) 
  ? (crossOrigin || "anonymous") 
  : "";

// CORSé”™è¯¯å¤„ç† - ä¼˜å…ˆå›é€€åˆ°æœ¬åœ°src
const handleCorsError = useCallback(() => {
  console.warn(`[Image] è·¨åŸŸåŠ è½½å¤±è´¥ï¼Œå°è¯•å›é€€: ${currentSrc}`);
  
  // priorityLoad=true æ—¶ï¼šfallbackSrcæ˜¯CDNï¼Œsrcæ˜¯æœ¬åœ° â†’ å›é€€åˆ°src
  if (priorityLoad && src && !isExternalUrl(src)) {
    const localUrl = getLocalImageUrl(src);
    console.warn(`[Image] ä¼˜å…ˆåŠ è½½CDNå¤±è´¥ï¼Œå›é€€åˆ°æœ¬åœ°å›¾ç‰‡: ${localUrl}`);
    setCurrentSrc(localUrl);
    setFallbackUsed(true);
    setHasError(false);
    setCorsStatus({ tried: false, failed: false });
  }
}, [currentSrc, src, priorityLoad]);
```

---

## å››ã€ä½¿ç”¨ç¤ºä¾‹

### 4.1 åŸºæœ¬ç”¨æ³• (VideoCover)

```typescript
import { VideoCover } from "../../../components/figma/ImageWithFallback";

// è§†é¢‘å¡ç‰‡ç»„ä»¶ä¸­ä½¿ç”¨
<VideoCover
  cover_url={video.cover_url}  // Bç«™CDN URLï¼ˆä¼˜å…ˆï¼‰
  cover={video.cover}          // æœ¬åœ°æ–‡ä»¶åï¼ˆå›é€€ï¼‰
  alt={video.title}
  className="w-full h-full object-cover"
/>
```

### 4.2 é«˜çº§ç”¨æ³• (ImageWithFallback)

```typescript
import { ImageWithFallback } from "../../../components/figma/ImageWithFallback";

<ImageWithFallback
  src="BV123456.jpg"                    // æœ¬åœ°è·¯å¾„
  fallbackSrc="https://i0.hdslb.com/..." // å¤–éƒ¨URL
  alt="è§†é¢‘å°é¢"
  priorityLoad={true}                   // ä¼˜å…ˆå¤–éƒ¨URL
  lazy={true}                           // æ‡’åŠ è½½
  crossOrigin="anonymous"               // CORSæ¨¡å¼
  className="w-full h-full"
  onError={() => console.error("åŠ è½½å¤±è´¥")}
/>
```

### 4.3 Canvaså¯¼å‡º (CanvasImage)

```typescript
import { CanvasImage } from "../../../components/figma/ImageWithFallback";

// ç”¨äºéœ€è¦å¯¼å‡ºå›¾ç‰‡çš„åœºæ™¯
<CanvasImage
  cover_url={video.cover_url}
  cover={video.cover}
  alt={video.title}
  width={300}
  height={200}
  onLoadSuccess={(canvas) => {
    // å¯ä»¥å¯¼å‡ºä¸ºbase64
    const dataUrl = canvas.toDataURL("image/png");
    console.log("å¯¼å‡ºæˆåŠŸ:", dataUrl);
  }}
  onLoadError={(error) => {
    console.error("å¯¼å‡ºå¤±è´¥:", error);
  }}
/>
```

---

## äº”ã€è°ƒè¯•ä¸ç›‘æ§

### 5.1 DOMå±æ€§

åŠ è½½çš„å›¾ç‰‡ä¼šåŒ…å«ä»¥ä¸‹æ•°æ®å±æ€§ï¼Œå¯ç”¨äºè°ƒè¯•ï¼š

| å±æ€§ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `data-image-source` | `external` | Bç«™CDN |
| `data-image-source` | `local` | æœ¬åœ°å›¾ç‰‡ |
| `data-image-source` | `fallback` | å›é€€åˆ°æœ¬åœ° |
| `data-image-source` | `error` | åŠ è½½å¤±è´¥ |
| `data-image-url` | URLå­—ç¬¦ä¸² | å®é™…åŠ è½½çš„URL |
| `data-cors-status` | `ok` | CORSæ­£å¸¸ |
| `data-cors-status` | `cors-failed` | CORSè¢«æ‹’ç» |

### 5.2 æ§åˆ¶å°è°ƒè¯•è„šæœ¬

```javascript
// æŸ¥çœ‹æ‰€æœ‰å›¾ç‰‡çš„åŠ è½½æº
document.querySelectorAll('[data-image-source]').forEach((img, i) => {
  const source = img.dataset.imageSource;
  const url = img.dataset.imageUrl;
  const cors = img.dataset.corsStatus;
  const emoji = {
    external: 'ğŸ”µ',
    local: 'ğŸŸ¢',
    fallback: 'ğŸŸ¡',
    error: 'ğŸ”´'
  }[source];
  console.log(`${emoji} ${source} [CORS:${cors}] ${url?.substring(0, 70)}...`);
});

// ç»Ÿè®¡åŠ è½½æºåˆ†å¸ƒ
const stats = { external: 0, local: 0, fallback: 0, error: 0 };
document.querySelectorAll('[data-image-source]').forEach(img => {
  stats[img.dataset.imageSource]++;
});
console.table(stats);

// æŸ¥çœ‹è·¨åŸŸå¤±è´¥çš„å›¾ç‰‡
document.querySelectorAll('[data-cors-status="cors-failed"]').forEach(img => {
  console.log('âŒ CORSå¤±è´¥:', img.dataset.imageUrl);
});
```

### 5.3 æ§åˆ¶å°æ—¥å¿—

ç»„ä»¶ä¼šè‡ªåŠ¨è¾“å‡ºåŠ è½½æ—¥å¿—ï¼š

```
[Image] åŠ è½½æˆåŠŸï¼ˆBç«™CDNï¼‰: https://i0.hdslb.com/bfs/archive/xxx.jpg
[Image] åŠ è½½æˆåŠŸï¼ˆæœ¬åœ°ï¼‰: /thumbs/BV123456789.jpg
[Image] è·¨åŸŸåŠ è½½å¤±è´¥ï¼Œå°è¯•å›é€€: https://i0.hdslb.com/...
[Image] åˆ‡æ¢åˆ°å›é€€æº: /thumbs/BV123456789.jpg
[Image] æ‰€æœ‰å›¾ç‰‡æºå‡åŠ è½½å¤±è´¥
```

---

## å…­ã€æ€§èƒ½ä¼˜åŒ–

### 6.1 å›¾ç‰‡å‹ç¼©

é¡¹ç›®å·²é…ç½® `vite-plugin-image-optimizer`ï¼Œæ„å»ºæ—¶è‡ªåŠ¨ä¼˜åŒ–å›¾ç‰‡ï¼š

```bash
# æ„å»ºè¾“å‡ºç¤ºä¾‹
build/thumbs/BV11ErKBfEqL.jpg     -85%    451.98 kB â­¢  69.81 kB
build/thumbs/BV1dNzXBTEVz.jpg     -86%    417.61 kB â­¢  60.34 kB
build/thumbs/BV1u2mXBUE7s.jpg     -83%    509.47 kB â­¢  88.11 kB

# æ€»èŠ‚çœ
ğŸ’° total savings = 5114.51kB/11121.39kB â‰ˆ 46%
```

### 6.2 æ‡’åŠ è½½

æ‰€æœ‰å°é¢å›¾é»˜è®¤å¯ç”¨æ‡’åŠ è½½ï¼š

```typescript
<VideoCover
  cover_url={video.cover_url}
  cover={video.cover}
  alt={video.title}
  priorityLoad={true}  // ä¼˜å…ˆå¤–éƒ¨URL
  lazy={true}          // æ‡’åŠ è½½
/>
```

ç”Ÿæˆçš„HTMLï¼š

```html
<img
  src="https://i0.hdslb.com/..."
  loading="lazy"           <!-- æµè§ˆå™¨æ‡’åŠ è½½ -->
  decoding="async"         <!-- å¼‚æ­¥è§£ç  -->
  crossOrigin="anonymous"  <!-- CORSæ”¯æŒ -->
  data-image-source="external"
  data-image-url="..."
/>
```

### 6.3 ç¼“å­˜ç­–ç•¥

| å›¾ç‰‡ç±»å‹ | ç¼“å­˜ç­–ç•¥ |
|---------|---------|
| Bç«™CDN | ä¾èµ–Bç«™CDNç¼“å­˜ï¼ˆé€šå¸¸7å¤©ï¼‰ |
| æœ¬åœ°å›¾ç‰‡ | Cloudflare Pagesç¼“å­˜ï¼ˆ1å¹´ï¼‰ |

---

## ä¸ƒã€å¸¸è§é—®é¢˜

### Q1: Bç«™CDNå›¾ç‰‡åŠ è½½æ…¢æ€ä¹ˆåŠï¼Ÿ

**åŸå› **: ç”¨æˆ·åœ°ç†ä½ç½®è·ç¦»Bç«™CDNèŠ‚ç‚¹è¾ƒè¿œ

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `priorityLoad` æ˜¯å¦å¼€å¯
2. è€ƒè™‘ä½¿ç”¨ä»£ç†æœåŠ¡å™¨
3. å®šæœŸæ›´æ–°æœ¬åœ°ç¼“å­˜å›¾ç‰‡

### Q2: CORSé”™è¯¯å¯¼è‡´canvaså¯¼å‡ºå¤±è´¥

**ç—‡çŠ¶**: `Tainted canvas` é”™è¯¯

**åŸå› **: Bç«™CDNä¸æ”¯æŒCORSæˆ–æœªæ­£ç¡®é…ç½®

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ `CanvasImage` ç»„ä»¶ï¼ˆå·²å†…ç½®CORSå¤„ç†ï¼‰
2. æˆ–å›é€€åˆ°æœ¬åœ°å›¾ç‰‡

### Q3: å¦‚ä½•åŒºåˆ†å›¾ç‰‡æ˜¯ä»å“ªä¸ªæºåŠ è½½çš„ï¼Ÿ

**æ–¹æ³•**:
1. æ£€æŸ¥ `data-image-source` å±æ€§
2. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
3. ä½¿ç”¨è°ƒè¯•è„šæœ¬

### Q4: æœ¬åœ°å›¾ç‰‡å’ŒCDNå›¾ç‰‡éƒ½æƒ³ç”¨æ€ä¹ˆåŠï¼Ÿ

**å½“å‰ç­–ç•¥**:
```typescript
// VideoCover ç»„ä»¶é»˜è®¤è¡Œä¸º
<VideoCover
  cover_url={video.cover_url}  // ä¼˜å…ˆï¼ˆå¤–éƒ¨ï¼‰
  cover={video.cover}          // å›é€€ï¼ˆæœ¬åœ°ï¼‰
  priorityLoad={true}          // ä¼˜å…ˆå¤–éƒ¨
/>
```

### Q5: å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°å›¾ç‰‡ï¼Ÿ

**æ–¹æ³•**:
```typescript
<VideoCover
  cover_url={video.cover_url}
  cover={video.cover}
  priorityLoad={false}  // ç¦ç”¨ä¼˜å…ˆåŠ è½½ï¼Œä½¿ç”¨æœ¬åœ°
/>
```

---

## å…«ã€ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `frontend/src/components/figma/ImageWithFallback.tsx` | æ ¸å¿ƒç»„ä»¶ |
| `frontend/src/features/tiantong/components/VideoCard.tsx` | ç”œç­’è§†é¢‘å¡ç‰‡ |
| `frontend/src/features/tiantong/components/VideoTimeline.tsx` | ç”œç­’æ—¶é—´çº¿ |
| `frontend/src/features/lvjiang/components/VideoTimeline.tsx` | é©´é…±æ—¶é—´çº¿ |
| `frontend/src/features/tiantong/data/types.ts` | ç”œç­’ç±»å‹å®šä¹‰ |
| `frontend/src/features/lvjiang/data/types.ts` | é©´é…±ç±»å‹å®šä¹‰ |
| `backend/src/crawler/auto_crawler.py` | çˆ¬è™«ï¼ˆæ·»åŠ cover_urlå­—æ®µï¼‰ |
| `docs/æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ.md` | æ€§èƒ½ä¼˜åŒ–æŒ‡å— |

---

## ä¹ã€æ‰©å±•åŠŸèƒ½

### 9.1 æ¸è¿›å¼åŠ è½½

å¯æ‰©å±•å®ç°æ¸è¿›å¼å›¾ç‰‡åŠ è½½ï¼ˆä½è´¨é‡å ä½ç¬¦ â†’ é«˜è´¨é‡å›¾ç‰‡ï¼‰ï¼š

```typescript
// ä¼ªä»£ç ç¤ºä¾‹
function ProgressiveImage({ cover_url, cover }) {
  const [quality, setQuality] = useState('low'); // low â†’ high
  
  return (
    <>
      {quality === 'low' && (
        <img src={getLowQualityUrl(cover)} />
      )}
      <ImageWithFallback
        src={cover}
        fallbackSrc={cover_url}
        onLoad={() => setQuality('high')}
      />
    </>
  );
}
```

### 9.2 å›¾ç‰‡é¢„åŠ è½½

```typescript
// é¢„åŠ è½½æŒ‡å®šè§†é¢‘çš„å°é¢
function preloadCover(video) {
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = video.cover_url || getLocalImageUrl(video.cover);
}

// åœ¨è·¯ç”±åˆ‡æ¢å‰é¢„åŠ è½½ä¸‹ä¸€é¡µå›¾ç‰‡
useEffect(() => {
  const videos = getUpcomingVideos();
  videos.forEach(preloadCover);
}, [currentRoute]);
```

### 9.3 ç¦»çº¿æ”¯æŒ

ç»“åˆService Workerå®ç°ç¦»çº¿è®¿é—®ï¼š

```javascript
// sw.js
self.addEventListener('fetch', (event) => {
  if (event.request.destination === 'image') {
    event.respondWith(
      caches.match(event.request).then((cached) => {
        return cached || fetch(event.request).then((response) => {
          // ç¼“å­˜å›¾ç‰‡å“åº”
          return caches.open('images-v1').then((cache) => {
            cache.put(event.request, response.clone());
            return response;
          });
        });
      })
    );
  }
});
```

---

## åã€ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|---------|
| 1.0.1 | 2026-02-01 | ä¿®å¤ CORS è·¨åŸŸå¤±è´¥æ—¶å›é€€åˆ°æœ¬åœ°å›¾ç‰‡çš„é€»è¾‘ |
| 1.0.0 | 2026-02-01 | åˆå§‹ç‰ˆæœ¬ï¼Œå®ç°åŸºç¡€åŠ è½½ã€CORSå¤„ç†ã€å›é€€æœºåˆ¶ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0

**æœ€åæ›´æ–°**: 2026å¹´2æœˆ1æ—¥

**ç»´æŠ¤äººå‘˜**: VidTimelineX å¼€å‘ç»„
